{"version":3,"file":"AaKudosLast.esm.js","sources":["../../../src/components/AaKudosLast/AaKudosLast.tsx"],"sourcesContent":["/* eslint-disable no-console */\r\nimport { Fragment } from 'react';\r\nimport { EmojiDataResponse, OrgUsersDataResponse, User } from '../../api/types';\r\nimport { Box } from '@material-ui/core';\r\nimport { Emoji } from 'emoji-picker-react';\r\nimport { Card, CardHeader, CardBody, Text } from '@backstage/ui';\r\n\r\nexport const AaKudosLast = ({\r\n  users,\r\n  kudos,\r\n  kudosLeaderBoard,\r\n}: {\r\n  users: { data: OrgUsersDataResponse };\r\n  kudos: EmojiDataResponse;\r\n  kudosLeaderBoard: any;\r\n  }) => {\r\n\r\n  const createFromToTitle = () => {\r\n    const fromUser = users.data.find(\r\n      (user: User) => user.hash === kudosLeaderBoard?.last_kudo.from,\r\n    );\r\n    const from = fromUser ? fromUser.user_name : '';\r\n    const toUser = users.data.find(\r\n      user => user.hash === kudosLeaderBoard?.last_kudo.to,\r\n    );\r\n    const to = toUser ? toUser.user_name : '';\r\n\r\n    return (\r\n      <Box sx={{ fontWeight: 700, fontSize: '18px', margin: 0, padding: 0 }}>\r\n        From <span className=\"person from\">{from}</span>\r\n        {' to '}\r\n        <span className=\"person to\">{to}</span>\r\n      </Box>\r\n    );\r\n  };\r\n\r\n  const createChannelTitle = () => {\r\n    const channel = kudosLeaderBoard?.last_kudo?.channel;\r\n\r\n    return (\r\n      <Box sx={{ color: '#ccc' }}>\r\n        #<span className=\"\">{channel}</span>\r\n      </Box>\r\n    );\r\n  };\r\n\r\n  const getEmojisFromMessage = () => {\r\n    const message = kudosLeaderBoard?.last_kudo.message\r\n      ? kudosLeaderBoard?.last_kudo.message\r\n      : '';\r\n    const emojiInMessageQuantity = kudosLeaderBoard?.last_kudo.amount\r\n      ? kudosLeaderBoard?.last_kudo.amount\r\n      : '0';\r\n    const regex = /:[^\\s]*:/gm;\r\n    const emojiInMessageArray = Array.from(message.matchAll(regex));\r\n\r\n    const listOfEmojis = kudos.filter(emoji => {\r\n      return emojiInMessageArray.findIndex((e: any) => e[0] === emoji);\r\n    });\r\n    \r\n    return (\r\n      <>\r\n        <Box\r\n          sx={{\r\n            marginRight: '8px',\r\n            fontSize: 40,\r\n            color: '#8ec358',\r\n            fontWeight: 500,\r\n          }}\r\n        >\r\n          +{emojiInMessageQuantity}\r\n        </Box>\r\n        <Box>\r\n          {listOfEmojis.map(emoji => {\r\n            if (emoji?.imgUrl) {\r\n              return (\r\n                <img\r\n                  src={emoji?.imgUrl}\r\n                  style={{ width: '40px', height: '40px' }}\r\n                  alt={emoji?.codepoint}\r\n                  key={emoji?.codepoint}\r\n                />\r\n              );\r\n            }\r\n            return (\r\n              <Emoji\r\n                unified={emoji.codepoint}\r\n                size={40}\r\n                key={emoji?.codepoint}\r\n              />\r\n            );\r\n          })}\r\n        </Box>\r\n      </>\r\n    );\r\n  };\r\n\r\n  const transformMessageWithEmoji = () => {\r\n    const message = kudosLeaderBoard?.last_kudo.message\r\n      ? kudosLeaderBoard?.last_kudo.message\r\n      : '';\r\n    const regex = /:[^\\s]*:/gm;\r\n    const emojiInMessage = message.matchAll(regex);\r\n    const emojiInMessageArray: any[] = Array.from(message.matchAll(regex));\r\n    const partOfStr = [];\r\n    let strStart = 0;\r\n\r\n    for (const emoji of emojiInMessage) {\r\n      const strPart = message.slice(strStart, emoji.index);\r\n      partOfStr.push(strPart);\r\n      strStart = emoji.index + emoji[0].length + 1;\r\n    }\r\n    partOfStr.push(message.slice(strStart));\r\n\r\n    const newmess = partOfStr.map((str, index) => {\r\n      if (index === partOfStr.length - 1) {\r\n        return str;\r\n      }\r\n      const emoji = emojiInMessageArray[index][0];\r\n      return (\r\n        <Fragment key={`${index}${emoji}`}>\r\n          {str}\r\n          {emoji?.imgUrl ? (\r\n            <img\r\n              src={emoji?.imgUrl}\r\n              style={{width: '18px', height: '18px'}}\r\n              alt={emoji?.codepoint}\r\n              key={emoji?.codepoint}\r\n\r\n            />\r\n          ) : (\r\n            <Emoji unified={emoji?.shortcode} size={18} />\r\n          )}\r\n        </Fragment>\r\n      );\r\n    });\r\n    return newmess;\r\n  };\r\n\r\n\r\n  const getContent = () => {\r\n    if (\r\n      +kudosLeaderBoard?.total_kudos === 0 ||\r\n      kudosLeaderBoard?.last_kudo && Object.keys(\r\n        kudosLeaderBoard?.last_kudo,\r\n      ).length === 0\r\n    ) {\r\n      return <Box>No messages</Box>;\r\n    }\r\n\r\n    return (\r\n      <Box>\r\n        <Box\r\n          sx={{\r\n            height: '100%',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n          }}\r\n        >\r\n          <Box>\r\n            {createFromToTitle()}\r\n            {createChannelTitle()}\r\n          </Box>\r\n          <Box sx={{ display: 'flex', alignItems: 'center' }}>\r\n            {getEmojisFromMessage()}\r\n          </Box>\r\n        </Box>\r\n        <Box\r\n          sx={{\r\n            padding: '12px',\r\n            borderRadius: '8px',\r\n            bgcolor: '#ccc',\r\n            marginTop: ' 16px',\r\n          }}\r\n        >\r\n          <Box className=\"message\">{transformMessageWithEmoji()}</Box>\r\n        </Box>\r\n      </Box>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Card style={{ height: '100%' }}>\r\n      <CardHeader>\r\n        <Text variant=\"title-medium\" weight=\"bold\">\r\n          Latest Kudos\r\n        </Text>\r\n      </CardHeader>\r\n      <CardBody>{getContent()}</CardBody>\r\n    </Card>\r\n  );\r\n};\r\n"],"names":["Fragment"],"mappings":"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"}