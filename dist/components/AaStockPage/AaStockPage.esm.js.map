{"version":3,"file":"AaStockPage.esm.js","sources":["../../../src/components/AaStockPage/AaStockPage.tsx"],"sourcesContent":["/* eslint-disable no-console */\r\nimport moment from 'moment';\r\nimport { InfoCard, Progress } from '@backstage/core-components';\r\nimport { configApiRef, useApi } from '@backstage/core-plugin-api';\r\nimport useAsync from 'react-use/lib/useAsync';\r\nimport Alert from '@material-ui/lab/Alert';\r\nimport { Grid } from '@material-ui/core';\r\nimport { Timeperiod } from '../../api/types';\r\nimport { agileAnalyticsApiRef } from '../../api';\r\nimport { AaDoraChart } from '../AaDoraChart';\r\n\r\nexport const AaStockPage = ({ timeperiod }: { timeperiod: Timeperiod }) => {\r\n  const api = useApi(agileAnalyticsApiRef);\r\n  const config = useApi(configApiRef);\r\n  const orgHash = config.getString('agileAnalytics.orgHash');\r\n  const apiKey = config.getString('agileAnalytics.apiKey');\r\n\r\n  const stockState = useAsync(async (): Promise<any> => {\r\n    const response = await api.getStockData({\r\n      orgHash,\r\n      apiKey,\r\n      dateStart: timeperiod?.date_start,\r\n      dateEnd: timeperiod?.date_end,\r\n    });\r\n    return response;\r\n  }, [timeperiod]);\r\n\r\n  const riskChartState = useAsync(async (): Promise<any> => {\r\n    const response = await api.getRiskChartData({\r\n      orgHash,\r\n      apiKey,\r\n      dateStart: timeperiod?.date_start,\r\n      dateEnd: timeperiod?.date_end,\r\n    });\r\n    return response;\r\n  }, [timeperiod]);\r\n\r\n  const createChartSeriesFromData = () => {\r\n    const getLabels = (buckets: any) => {\r\n      if (!buckets) {\r\n        return [];\r\n      }\r\n      const labels: number[] = [];\r\n\r\n      const timestamps = Object.keys(buckets);\r\n      if (!timestamps.length) {\r\n        return [];\r\n      }\r\n      timestamps.forEach(item => {\r\n        const start_date = moment(item).unix();\r\n        labels.push(start_date);\r\n      });\r\n\r\n      return labels;\r\n    };\r\n\r\n    const series = stockState?.value\r\n      ? Object.keys(stockState?.value)\r\n          .filter(item => item !== 'buckets')\r\n          .reduce((acc: { name: string; data: number[][] }[], item) => {\r\n            const formatted = {\r\n              name: item,\r\n              data: getLabels(stockState.value?.buckets).map((date, i) => [\r\n                date * 1000,\r\n                stockState.value[item][i]?.avg_branch_total_modified_lines,\r\n              ]),\r\n              type: 'column',\r\n            };\r\n            return [...acc, formatted];\r\n          }, [])\r\n      : [];\r\n\r\n    return series;\r\n  };\r\n\r\n  const createRiskChartSeriesFromData = () => {\r\n    if (!riskChartState?.value) {\r\n      return [];\r\n    }\r\n    const series = [\r\n      {\r\n        name: '',\r\n        data: Object.entries(riskChartState?.value).map(entry => {\r\n          return [entry[0][0].toUpperCase() + entry[0].slice(1), entry[1]];\r\n        }),\r\n        type: 'pie',\r\n      },\r\n    ];\r\n    return series;\r\n  };\r\n\r\n  const chartOptions = [\r\n    {\r\n      series: createChartSeriesFromData(),\r\n    },\r\n  ];\r\n\r\n  const riskChartOptions = [\r\n    {\r\n      series: createRiskChartSeriesFromData(),\r\n    },\r\n  ];\r\n\r\n  if (stockState?.loading) {\r\n    return <Progress />;\r\n  } else if (stockState?.error) {\r\n    return <Alert severity=\"error\">{stockState?.error.message}</Alert>;\r\n  }\r\n\r\n  return (\r\n    <Grid container spacing={2}>\r\n      <Grid item xs={12} lg={8}>\r\n        <InfoCard title=\"Stock\">\r\n          <AaDoraChart\r\n            timeperiod={timeperiod}\r\n            charts={chartOptions}\r\n            chartColor={[\r\n              '#15a2bb',\r\n              '#54afc4',\r\n              '#79bccd',\r\n              '#99c9d6',\r\n              '#b7d6df',\r\n              '#d4e3e8',\r\n              '#f1f1f1',\r\n              '#f7dbde',\r\n              '#fcc5cb',\r\n              '#ffaeb9',\r\n              '#ff97a7',\r\n              '#ff7e95',\r\n              '#ff6384',\r\n            ]}\r\n            // chartHeight={360}\r\n            loading={stockState.loading}\r\n            customPointFormatter={null}\r\n            customOptions={null}\r\n            yAxisFormatter={null}\r\n            yAxisTitle=\"Average number of modified lines\"\r\n            customOpacity={1}\r\n          />\r\n        </InfoCard>\r\n      </Grid>\r\n      <Grid item xs={12} lg={4}>\r\n        <InfoCard\r\n          title=\"Risk Chart\"\r\n          deepLink={{\r\n            title: 'Go to Agile Analytics to see a detailed report  ',\r\n            link: 'https://www.prod.agileanalytics.cloud/stock',\r\n          }}\r\n        >\r\n          {riskChartState.error ? (\r\n            <Alert severity=\"error\">{riskChartState?.error.message}</Alert>\r\n          ) : null}\r\n          <AaDoraChart\r\n            timeperiod={timeperiod}\r\n            charts={riskChartOptions}\r\n            chartColor={['#92CE52', '#F8C238', '#E11E1E']}\r\n            loading={riskChartState.loading}\r\n            customPointFormatter={function (this: any) {\r\n              return `<span>Branches amount: <b>${this.options.y}</b></span>`;\r\n            }}\r\n            customOptions={null}\r\n            yAxisFormatter={null}\r\n            customOpacity={1}\r\n          />\r\n        </InfoCard>\r\n      </Grid>\r\n    </Grid>\r\n  );\r\n};\r\n"],"names":[],"mappings":";;;;;;;;;;AAWO,MAAM,WAAA,GAAc,CAAC,EAAE,UAAA,EAAW,KAAkC;AACzE,EAAA,MAAM,GAAA,GAAM,OAAO,oBAAoB,CAAA;AACvC,EAAA,MAAM,MAAA,GAAS,OAAO,YAAY,CAAA;AAClC,EAAA,MAAM,OAAA,GAAU,MAAA,CAAO,SAAA,CAAU,wBAAwB,CAAA;AACzD,EAAA,MAAM,MAAA,GAAS,MAAA,CAAO,SAAA,CAAU,uBAAuB,CAAA;AAEvD,EAAA,MAAM,UAAA,GAAa,SAAS,YAA0B;AACpD,IAAA,MAAM,QAAA,GAAW,MAAM,GAAA,CAAI,YAAA,CAAa;AAAA,MACtC,OAAA;AAAA,MACA,MAAA;AAAA,MACA,WAAW,UAAA,EAAY,UAAA;AAAA,MACvB,SAAS,UAAA,EAAY;AAAA,KACtB,CAAA;AACD,IAAA,OAAO,QAAA;AAAA,EACT,CAAA,EAAG,CAAC,UAAU,CAAC,CAAA;AAEf,EAAA,MAAM,cAAA,GAAiB,SAAS,YAA0B;AACxD,IAAA,MAAM,QAAA,GAAW,MAAM,GAAA,CAAI,gBAAA,CAAiB;AAAA,MAC1C,OAAA;AAAA,MACA,MAAA;AAAA,MACA,WAAW,UAAA,EAAY,UAAA;AAAA,MACvB,SAAS,UAAA,EAAY;AAAA,KACtB,CAAA;AACD,IAAA,OAAO,QAAA;AAAA,EACT,CAAA,EAAG,CAAC,UAAU,CAAC,CAAA;AAEf,EAAA,MAAM,4BAA4B,MAAM;AACtC,IAAA,MAAM,SAAA,GAAY,CAAC,OAAA,KAAiB;AAClC,MAAA,IAAI,CAAC,OAAA,EAAS;AACZ,QAAA,OAAO,EAAC;AAAA,MACV;AACA,MAAA,MAAM,SAAmB,EAAC;AAE1B,MAAA,MAAM,UAAA,GAAa,MAAA,CAAO,IAAA,CAAK,OAAO,CAAA;AACtC,MAAA,IAAI,CAAC,WAAW,MAAA,EAAQ;AACtB,QAAA,OAAO,EAAC;AAAA,MACV;AACA,MAAA,UAAA,CAAW,QAAQ,CAAA,IAAA,KAAQ;AACzB,QAAA,MAAM,UAAA,GAAa,MAAA,CAAO,IAAI,CAAA,CAAE,IAAA,EAAK;AACrC,QAAA,MAAA,CAAO,KAAK,UAAU,CAAA;AAAA,MACxB,CAAC,CAAA;AAED,MAAA,OAAO,MAAA;AAAA,IACT,CAAA;AAEA,IAAA,MAAM,SAAS,UAAA,EAAY,KAAA,GACvB,MAAA,CAAO,IAAA,CAAK,YAAY,KAAK,CAAA,CAC1B,MAAA,CAAO,CAAA,IAAA,KAAQ,SAAS,SAAS,CAAA,CACjC,MAAA,CAAO,CAAC,KAA2C,IAAA,KAAS;AAC3D,MAAA,MAAM,SAAA,GAAY;AAAA,QAChB,IAAA,EAAM,IAAA;AAAA,QACN,IAAA,EAAM,UAAU,UAAA,CAAW,KAAA,EAAO,OAAO,CAAA,CAAE,GAAA,CAAI,CAAC,IAAA,EAAM,CAAA,KAAM;AAAA,UAC1D,IAAA,GAAO,GAAA;AAAA,UACP,UAAA,CAAW,KAAA,CAAM,IAAI,CAAA,CAAE,CAAC,CAAA,EAAG;AAAA,SAC5B,CAAA;AAAA,QACD,IAAA,EAAM;AAAA,OACR;AACA,MAAA,OAAO,CAAC,GAAG,GAAA,EAAK,SAAS,CAAA;AAAA,IAC3B,CAAA,EAAG,EAAE,CAAA,GACP,EAAC;AAEL,IAAA,OAAO,MAAA;AAAA,EACT,CAAA;AAEA,EAAA,MAAM,gCAAgC,MAAM;AAC1C,IAAA,IAAI,CAAC,gBAAgB,KAAA,EAAO;AAC1B,MAAA,OAAO,EAAC;AAAA,IACV;AACA,IAAA,MAAM,MAAA,GAAS;AAAA,MACb;AAAA,QACE,IAAA,EAAM,EAAA;AAAA,QACN,MAAM,MAAA,CAAO,OAAA,CAAQ,gBAAgB,KAAK,CAAA,CAAE,IAAI,CAAA,KAAA,KAAS;AACvD,UAAA,OAAO,CAAC,KAAA,CAAM,CAAC,CAAA,CAAE,CAAC,EAAE,WAAA,EAAY,GAAI,KAAA,CAAM,CAAC,EAAE,KAAA,CAAM,CAAC,CAAA,EAAG,KAAA,CAAM,CAAC,CAAC,CAAA;AAAA,QACjE,CAAC,CAAA;AAAA,QACD,IAAA,EAAM;AAAA;AACR,KACF;AACA,IAAA,OAAO,MAAA;AAAA,EACT,CAAA;AAEA,EAAA,MAAM,YAAA,GAAe;AAAA,IACnB;AAAA,MACE,QAAQ,yBAAA;AAA0B;AACpC,GACF;AAEA,EAAA,MAAM,gBAAA,GAAmB;AAAA,IACvB;AAAA,MACE,QAAQ,6BAAA;AAA8B;AACxC,GACF;AAEA,EAAA,IAAI,YAAY,OAAA,EAAS;AACvB,IAAA,2BAAQ,QAAA,EAAA,EAAS,CAAA;AAAA,EACnB,CAAA,MAAA,IAAW,YAAY,KAAA,EAAO;AAC5B,IAAA,2BAAQ,KAAA,EAAA,EAAM,QAAA,EAAS,OAAA,EAAS,QAAA,EAAA,UAAA,EAAY,MAAM,OAAA,EAAQ,CAAA;AAAA,EAC5D;AAEA,EAAA,uBACE,IAAA,CAAC,IAAA,EAAA,EAAK,SAAA,EAAS,IAAA,EAAC,SAAS,CAAA,EACvB,QAAA,EAAA;AAAA,oBAAA,GAAA,CAAC,IAAA,EAAA,EAAK,IAAA,EAAI,IAAA,EAAC,EAAA,EAAI,EAAA,EAAI,IAAI,CAAA,EACrB,QAAA,kBAAA,GAAA,CAAC,QAAA,EAAA,EAAS,KAAA,EAAM,OAAA,EACd,QAAA,kBAAA,GAAA;AAAA,MAAC,WAAA;AAAA,MAAA;AAAA,QACC,UAAA;AAAA,QACA,MAAA,EAAQ,YAAA;AAAA,QACR,UAAA,EAAY;AAAA,UACV,SAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAA;AAAA,UACA;AAAA,SACF;AAAA,QAEA,SAAS,UAAA,CAAW,OAAA;AAAA,QACpB,oBAAA,EAAsB,IAAA;AAAA,QACtB,aAAA,EAAe,IAAA;AAAA,QACf,cAAA,EAAgB,IAAA;AAAA,QAChB,UAAA,EAAW,kCAAA;AAAA,QACX,aAAA,EAAe;AAAA;AAAA,OAEnB,CAAA,EACF,CAAA;AAAA,wBACC,IAAA,EAAA,EAAK,IAAA,EAAI,MAAC,EAAA,EAAI,EAAA,EAAI,IAAI,CAAA,EACrB,QAAA,kBAAA,IAAA;AAAA,MAAC,QAAA;AAAA,MAAA;AAAA,QACC,KAAA,EAAM,YAAA;AAAA,QACN,QAAA,EAAU;AAAA,UACR,KAAA,EAAO,kDAAA;AAAA,UACP,IAAA,EAAM;AAAA,SACR;AAAA,QAEC,QAAA,EAAA;AAAA,UAAA,cAAA,CAAe,KAAA,uBACb,KAAA,EAAA,EAAM,QAAA,EAAS,SAAS,QAAA,EAAA,cAAA,EAAgB,KAAA,CAAM,SAAQ,CAAA,GACrD,IAAA;AAAA,0BACJ,GAAA;AAAA,YAAC,WAAA;AAAA,YAAA;AAAA,cACC,UAAA;AAAA,cACA,MAAA,EAAQ,gBAAA;AAAA,cACR,UAAA,EAAY,CAAC,SAAA,EAAW,SAAA,EAAW,SAAS,CAAA;AAAA,cAC5C,SAAS,cAAA,CAAe,OAAA;AAAA,cACxB,sBAAsB,WAAqB;AACzC,gBAAA,OAAO,CAAA,0BAAA,EAA6B,IAAA,CAAK,OAAA,CAAQ,CAAC,CAAA,WAAA,CAAA;AAAA,cACpD,CAAA;AAAA,cACA,aAAA,EAAe,IAAA;AAAA,cACf,cAAA,EAAgB,IAAA;AAAA,cAChB,aAAA,EAAe;AAAA;AAAA;AACjB;AAAA;AAAA,KACF,EACF;AAAA,GAAA,EACF,CAAA;AAEJ;;;;"}