{"version":3,"file":"AaKudosChart.esm.js","sources":["../../../src/components/AaKudosChart/AaKudosChart.tsx"],"sourcesContent":["/* eslint-disable no-console */\r\nimport { KudosChartResponse, Timeperiod, User } from '../../api/types';\r\nimport { Progress } from '@backstage/core-components';\r\nimport { Box, Typography } from '@material-ui/core';\r\nimport Chart from 'react-google-charts';\r\nimport { configApiRef, useApi } from '@backstage/core-plugin-api';\r\nimport { agileAnalyticsApiRef } from '../../api';\r\nimport useAsync from 'react-use/lib/useAsync';\r\nimport Alert from '@material-ui/lab/Alert';\r\n\r\nexport const AaKudosChart = ({\r\n  timeperiod,\r\n  users,\r\n  activeTeam,\r\n}: {\r\n  timeperiod: Timeperiod;\r\n  users: { data: User[] };\r\n  activeTeam: string;\r\n}) => {\r\n  const api = useApi(agileAnalyticsApiRef);\r\n  const config = useApi(configApiRef);\r\n  const orgHash = config.getString('agileAnalytics.orgHash');\r\n  const apiKey = config.getString('agileAnalytics.apiKey');\r\n\r\n  const { date_end, date_start } = timeperiod;\r\n\r\n  const kudosSankeyState = useAsync(async (): Promise<KudosChartResponse> => {\r\n    const response = await api.getTeamKudosSankeyData({\r\n      orgHash,\r\n      apiKey,\r\n      team: activeTeam ? activeTeam : 'all',\r\n      date_end,\r\n      date_start,\r\n    });\r\n    return response;\r\n  }, [timeperiod]);\r\n\r\n  const getChartHeight = () => {\r\n    if (kudosSankeyState?.value?.length) {\r\n      const senders = new Set(\r\n        kudosSankeyState?.value.map(chartDataItem => chartDataItem[0]),\r\n      );\r\n      const recipient = new Set(\r\n        kudosSankeyState?.value.map(chartDataItem => chartDataItem[1]),\r\n      );\r\n\r\n      if (senders.size === recipient.size || senders.size > recipient.size) {\r\n        return `${senders.size}00px`;\r\n      }\r\n      return `${recipient.size}00px`;\r\n    }\r\n    return '500px';\r\n  };\r\n\r\n  const getUserName = (userHash?: string | number) => {\r\n    const hash = userHash ? `${userHash}`?.split(' ').join('') : '';\r\n\r\n    return users?.data?.find(user => user.hash === hash)?.user_name;\r\n  };\r\n\r\n  const transformationData = () => {\r\n    const newData = kudosSankeyState?.value?.map(item => {\r\n      const nameFrom = getUserName(item[0]);\r\n      const nameTo = `${getUserName(item[1])} `;\r\n      const tooltipStr = `${nameFrom} gave ${item[2]} kudo(s) to ${nameTo}`;\r\n\r\n      return [nameFrom, nameTo, item[2], tooltipStr];\r\n    });\r\n\r\n    return [\r\n      ['From', 'To', 'Quantity', { type: 'string', role: 'tooltip' }],\r\n      ...(newData?.length ? newData : []),\r\n    ];\r\n  };\r\n\r\n  if (kudosSankeyState?.loading) {\r\n    return <Progress />;\r\n  } else if (kudosSankeyState?.error) {\r\n    return <Alert severity=\"error\">{kudosSankeyState?.error?.message}</Alert>;\r\n  } else if (!kudosSankeyState?.value || !kudosSankeyState?.value?.length) {\r\n    return <Typography component=\"p\">No data</Typography>;\r\n  }\r\n\r\n  return (\r\n    <Box>\r\n      <Chart\r\n        width=\"100%\"\r\n        height={getChartHeight()}\r\n        chartType=\"Sankey\"\r\n        options={{\r\n          sankey: {\r\n            fontName: \"'Roboto', sans-serif\",\r\n            node: {\r\n              colors: ['#D8D95C', '#8EC358', '#EE8282', '#4C72BD', '#484A53'],\r\n\r\n              label: {\r\n                color: '#484A53',\r\n                fontSize: '16',\r\n              },\r\n            },\r\n\r\n            link: {\r\n              colorMode: 'gradient',\r\n              colors: ['#D8D95C', '#8EC358', '#EE8282', '#4C72BD', '#484A53'],\r\n            },\r\n          },\r\n        }}\r\n        loader={<div>Loading Chart</div>}\r\n        data={transformationData()}\r\n        rootProps={{ 'data-testid': '1' }}\r\n      />\r\n    </Box>\r\n  );\r\n};\r\n"],"names":[],"mappings":"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"}